(()=>{"use strict";var t={730:(t,e)=>{}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}(()=>{n(730);function t(t,e){if(!t)throw new Error("function"==typeof e?e():e)}var e=class extends Error{constructor(t){super(`offset (${t.idx}) is not equal to array bytes length (${t.u8.byteLength})`)}},r=class{static encode(t,e){const n=new r(new Uint8Array(e.sizeHint(t)));return e(t,n),n.checkFinalOffset(),n.u8}static decode(t,e){const n=new r(t),i=e(n);return n.checkFinalOffset(),i}u8;view;idx=0;constructor(t){if(!ArrayBuffer.isView(t))throw new Error(`Passed source is not an ArrayBufferView (${String(t)})`);this.u8=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.view=new DataView(t.buffer,t.byteOffset,t.byteLength)}checkFinalOffset(){if(this.idx!==this.u8.byteLength)throw new e(this)}setOffset(t){return this.idx=t,this}};function i(t,e){return t.sizeHint=e,t}i((()=>{}),(()=>0)),i(((t,e)=>{e.u8[e.idx++]=t?1:0}),(()=>1));var o={i8:1,u8:1,i16:2,u16:2,i32:4,u32:4,i64:8,u64:8,i128:16,u128:16,i256:32,u256:32,i512:64,u512:64},s=t=>()=>o[t],u=t=>8===o[t],a=t=>o[t]<=4,c=t=>"i"===t[0];function d(e,n){const r=e<0,i=c(n);return t(!r||i,(()=>`Negative num (${e}) is passed to unsigned ("${n}") encoder`)),r}function l(e,n,r){d(e,n),t(Number.isSafeInteger(e),(()=>`Unsafe integer (${e}) is passed into encoder`));const{view:i,idx:s}=r;switch(n){case"i8":i.setInt8(s,e);break;case"u8":i.setUint8(s,e);break;case"i16":i.setInt16(s,e,!0);break;case"u16":i.setUint16(s,e,!0);break;case"i32":i.setInt32(s,e,!0);break;case"u32":i.setUint32(s,e,!0)}r.idx+=o[n]}function f(t,e){const{view:n,idx:r}=t;let i;switch(e){case"i8":i=n.getInt8(r);break;case"u8":i=n.getUint8(r);break;case"i16":i=n.getInt16(r,!0);break;case"u16":i=n.getUint16(r,!0);break;case"i32":i=n.getInt32(r,!0);break;case"u32":i=n.getUint32(r,!0)}return t.idx+=o[e],i}function g(t,e,n,r){let i=0;for(;t>0&&i<r;)e[n+i++]=Number(0xffn&t),t>>=8n;if(t>0)throw new Error(`Number ${t} is out of bytes limit (${r})`);return i}function h(t,e,n){if(a(e))return l(Number(t),e,n);if(u(e))return function(t,e,n){d(t,e);const{view:r,idx:i}=n;switch(e){case"u64":r.setBigUint64(i,t,!0);break;case"i64":r.setBigInt64(i,t,!0)}n.idx+=o[e]}(t,e,n);const r=d(t,e),i=o[e];r&&(t=BigInt.asUintN(8*i,t)),g(t,n.u8,n.idx,i),n.idx+=i}function p(t,e,n){let r=n&&(128&t.u8[t.idx+e-1])>>7==1,i=0n;for(let n=0,r=0n;n<e;n++,r+=8n)i+=BigInt(t.u8[t.idx+n])<<r;return r&&(i=BigInt.asIntN(8*e,i)),i}function b(t,e){if(a(e))return BigInt(f(t,e));if(u(e))return function(t,e){const{view:n,idx:r}=t;let i;switch(e){case"u64":i=n.getBigUint64(r,!0);break;case"i64":i=n.getBigInt64(r,!0)}return t.idx+=o[e],i}(t,e);const n=c(e),r=o[e],i=p(t,r,n);return t.idx+=r,i}function x(t){return i(((e,n)=>l(e,t,n)),s(t))}function w(t){return e=>f(e,t)}function y(t){return i(((e,n)=>h(e,t,n)),s(t))}function I(t){return e=>b(e,t)}x("u8"),w("u8"),x("i8"),w("i8"),x("u16"),w("u16"),x("i16"),w("i16"),x("u32"),w("u32"),x("i32"),w("i32");var v=y("u64"),k=(I("u64"),y("i64"),I("i64"),y("u128")),$=(I("u128"),y("i128"),I("i128"),2**30-1);function S(t){const e=t.u8[t.idx];switch(3&e){case 0:return t.idx++,BigInt(e>>2);case 1:return b(t,"u16")>>2n;case 2:return b(t,"u32")>>2n;default:{const n=4+(e>>2);t.idx++;const r=p(t,n,!1);return t.idx+=n,r}}}var A=(t,e)=>{if(!(t>=0)||!Number.isInteger(t)&&"bigint"!=typeof t)throw new Error(`Invalid number is passed: ${t}. It should be non-negative integer.`);if(t<=63)return void(e.u8[e.idx++]=Number(t)<<2);if(t<=16383)return void h((BigInt(t)<<2n)+1n,"u16",e);if(t<=$)return void h((BigInt(t)<<2n)+2n,"u32",e);const n=g(BigInt(t),e.u8,e.idx+1,1/0);e.u8[e.idx]=3+(n-4<<2),e.idx+=1+n};A.sizeHint=function(t){return t<=63?1:t<=16383?2:t<=$?4:1+function(t){let e=0;for(;t>0;)e++,t>>=8n;return e}(BigInt(t))};i(((t,e)=>{A(t.byteLength,e),e.u8.set(t,e.idx),e.idx+=t.byteLength}),(t=>A.sizeHint(t.byteLength)+t.byteLength));var B=new TextEncoder,F=new TextDecoder("utf-8",{fatal:!0});function T(t){let e=t.length;for(let n=t.length-1;n>=0;n--){const r=t.charCodeAt(n);r>127&&r<=2047?e++:r>2047&&r<=65535&&(e+=2),r>=56320&&r<=57343&&n--}return e}var m=i(((t,e)=>{const n=T(t);A(n,e);const r=B.encodeInto(t,e.u8.subarray(e.idx));if(r.written!==n)throw new Error(`SCALE internal error: counting of string bytes length is incorrect; string: "${t}"; actual bytes length: ${r.written}; computed: ${n}; please report a bug.`);e.idx+=n}),(t=>{const e=T(t);return e+A.sizeHint(e)}));function U(t){return i(((e,n)=>function(t,e,n){for(let r=0,i=e.length,o=null;r<i;r++)o=e[r],o[1](t[o[0]],n)}(e,t,n)),(e=>function(t,e){let n=0;for(let r=e.length-1,i=null;r>=0;r--)i=e[r],n+=i[1].sizeHint(t[i[0]]);return n}(e,t)))}i(((t,e)=>{e.u8[e.idx++]="None"===t.tag?0:t.content?1:2}),(()=>1));const N=(O=[["dappId",function(t){const e=(t=>{const e=Number(S(t)),n=t.u8.slice(t.idx,t.idx+e);return t.idx+=e,n})(t);return F.decode(e)}]],t=>function(t,e){const n={};for(let r=0,i=e.length,o=null;r<i;r++)o=e[r],n[o[0]]=o[1](t);return n}(t,O));var O;const L=U([["developerAddress",m],["nbStakers",v],["totalStake",k]]),C=U([["dappId",m],["response_value",L]]);var D;!function(t){t.FailedToFetchData="FailedToFetchData",t.FailedToDecode="FailedToDecode"}(D||(D={})),globalThis.scriptOutput=function(t,e){console.log(`handle req: ${t}`),console.log(`settings: ${e}`);const n=e,i=function(t){let e=t.toString();if(!/^0x[0-9a-f]+$/.test(e.toLowerCase()))throw D.FailedToDecode;e=e.slice(2);let n=new Array,i=0;for(let t=0;t<e.length;t+=2)n[i++]=parseInt(e.substring(t,t+2),16);return r.decode(new Uint8Array(n),N)}(t).dappId;console.log(`Request received for dApp ${i}`),console.log(`Query endpoint ${n}`);try{const t=function(t,e){let n;n=40==e.length?"0x"+e:e;let r=function(t){for(var e="",n=0;n<t.length;n++)e+=t.charCodeAt(n).toString(16);return"0x"+e}(JSON.stringify({query:`query{\n                  dApps (\n                    filter: {\n                      id: {\n                        inInsensitive: ["${n}"]\n                      }\n                    }\n                  ){\n                    nodes {\n                      id\n                      accountId\n                      registered\n                      stakes (\n                        filter: { totalStake : {notEqualTo: "0"} }\n                      ){\n                        totalCount\n                        aggregates{ sum {totalStake} }\n                      }\n                    }\n                  }\n                }`})),i=pink.batchHttpRequest([{url:t,method:"POST",headers:{"Content-Type":"application/json","User-Agent":"phat-contract"},body:r,returnTextBody:!0}],1e4)[0];if(200!==i.statusCode)throw console.log(`Fail to read Graph api with status code: ${i.statusCode}, error: ${i.error||i.body}}`),D.FailedToFetchData;let o=i.body;if("string"!=typeof o)throw D.FailedToDecode;return JSON.parse(o)}(n,i);let e=t.data.dApps.nodes[0];const o={developerAddress:e.accountId,nbStakers:BigInt(e.stakes.totalCount),totalStake:BigInt(parseFloat(e.stakes.aggregates.sum.totalStake))},s={dappId:i,response_value:o};return console.log(`output - dappId: ${s.dappId}`),console.log(`output - developerAddress: ${o.developerAddress}`),console.log(`output - nbStakers: ${o.nbStakers}`),console.log(`output - totalStake: ${o.totalStake}`),function(t){const e=r.encode(t,C);return console.log("encodedOutput:",e),e}(s)}catch(t){throw console.log("error:",t),t}}.apply(null,globalThis.scriptArgs)})()})();